# Development profile - connects to MariaDB running in Docker (service: mariadb)
spring:
  datasource:
    url: jdbc:mariadb://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:kraft_db}?useUnicode=true&characterEncoding=utf8mb4&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true
    username: ${DB_USER:kraft_user}
    # IDE에서 .env를 자동으로 로드하지 않는 경우를 대비해 안전한 기본값을 명시합니다.
    # 우선순위: SPRING_DATASOURCE_PASSWORD -> DB_PASSWORD -> 기본값
    password: ${SPRING_DATASOURCE_PASSWORD:${DB_PASSWORD:Gkstmvns1!}}
    driver-class-name: org.mariadb.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-test-query: SELECT 1

  # datasource SQL 초기화 비활성화 (spring.datasource.initialization-mode는 deprecated)
  sql:
    init:
      mode: never

  jpa:
    show-sql: true
    hibernate:
      ddl-auto: update   # 개발 환경에서는 누락 테이블 문제를 자동으로 보완하기 위해 update 사용
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MariaDBDialect
        jdbc:
          time_zone: Asia/Seoul

  # Redis 설정
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 2
          max-wait: -1ms
      timeout: 3000ms

  # Spring Session Redis 설정
  session:
    store-type: redis
    timeout: 1800s  # 30분
    redis:
      namespace: kraft:session
      flush-mode: on_save
      cleanup-cron: "0 * * * * *"  # 매분마다 만료된 세션 정리

  # Flyway configuration - manage DB schema with Flyway
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    clean-disabled: true
    validate-on-migrate: true

# Logging
logging:
  level:
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    com.zaxxer.hikari: DEBUG
    org.springframework.jdbc: DEBUG
